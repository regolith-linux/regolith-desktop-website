<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="General information regarding how Regolith packages and ISOs are built"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Build System"><meta property="og:description" content="General information regarding how Regolith packages and ISOs are built"><meta property="og:type" content="article"><meta property="og:url" content="https://regolith-desktop.com/docs/reference/build-system/"><meta property="article:modified_time" content="2024-03-04T18:42:16-08:00"><title>Build System | Regolith Desktop</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.61d73a415bb9c8ffe16c88a1ca6c5fd0ce9de44ebea50c24ec8cd964e10bada0.css integrity="sha256-Ydc6QVu5yP/hbIihymxf0M6d5E6+pQwk7IzZZOELraA=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.ef6deec09254aeee22615551f32b2f43c7819f38261e5fd82b5933ab1e3f0272.js integrity="sha256-723uwJJUru4iYVVR8ysvQ8eBnzgmHl/YK1kzqx4/AnI=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H87N5GZVTN"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-H87N5GZVTN');</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/regolith-logo.png alt="Regolith Desktop"></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></label><ul><li><a href=https://regolith-desktop.com/de/>German</a></li><li><a href=https://regolith-desktop.com/fr/>French</a></li><li><a href=https://regolith-desktop.com/ja/>Japanese</a></li></ul></li></ul><ul><li><span>Using Regolith</span><ul><li><a href=https://regolith-desktop.com/docs/using-regolith/install/>Install</a></li><li><a href=https://regolith-desktop.com/docs/using-regolith/first-launch/>First Launch</a></li><li><a href=https://regolith-desktop.com/docs/using-regolith/basics/>Basic Usage</a></li><li><a href=https://regolith-desktop.com/docs/using-regolith/configuration/>Configuration</a></li></ul></li><li><input type=checkbox id=section-36a2e89f4a5867cd31fc4eacbc82b305 class=toggle>
<label for=section-36a2e89f4a5867cd31fc4eacbc82b305 class="flex justify-between"><a href=https://regolith-desktop.com/docs/howtos/>How To</a></label><ul><li><a href=https://regolith-desktop.com/docs/howtos/customize-i3-configuration/>Customize i3 Configuration</a></li><li><a href=https://regolith-desktop.com/docs/howtos/workspace-on-output/>Assign a workspace to a specific Output (Display)</a></li><li><a href=https://regolith-desktop.com/docs/howtos/add-remove-blocklets/>Change Bar Status indicators</a></li><li><a href=https://regolith-desktop.com/docs/howtos/replace-notification-system/>Change Notification Systems</a></li><li><a href=https://regolith-desktop.com/docs/howtos/time-format/>Change the Bar Date and Time Format</a></li><li><a href=https://regolith-desktop.com/docs/howtos/change-terminal/>Change the Default Terminal</a></li><li><a href=https://regolith-desktop.com/docs/howtos/default-gap/>Change the Default Window Gap</a></li><li><a href=https://regolith-desktop.com/docs/howtos/change-lockscreen/>Change the lock screen program</a></li><li><a href=https://regolith-desktop.com/docs/howtos/terminal-font/>Change the Terminal Font Size</a></li><li><a href=https://regolith-desktop.com/docs/howtos/change-workspace-icons/>Change Workspace Icons and Labels</a></li><li><a href=https://regolith-desktop.com/docs/howtos/disable-unclutter/>Disable Mouse Hiding (unclutter)</a></li><li><a href=https://regolith-desktop.com/docs/howtos/find-install-packages/>Find and Install Packages</a></li><li><a href=https://regolith-desktop.com/docs/howtos/customize-compositor/>Customize Compositor</a></li><li><a href=https://regolith-desktop.com/docs/howtos/hide-i3-bar-by-default/>How to Hide i3-bar by default</a></li><li><a href=https://regolith-desktop.com/docs/howtos/install-sway/>Install the Sway Compositor</a></li><li><a href=https://regolith-desktop.com/docs/howtos/floating-window/>Launch an app in a Floating Window</a></li><li><a href=https://regolith-desktop.com/docs/howtos/vanilla-i3-gaps/>Launch Default i3 Session</a></li><li><a href=https://regolith-desktop.com/docs/howtos/tdcli-blocklet/>Manage a To-Do List</a></li><li><a href=https://regolith-desktop.com/docs/howtos/minimal-ubuntu-install/>Minimal Ubuntu Install</a></li><li><a href=https://regolith-desktop.com/docs/howtos/override-xres/>Override Xresources</a></li><li><a href=https://regolith-desktop.com/docs/howtos/remove-unneeded-deps/>Remove Unneeded Dependencies</a></li><li><a href=https://regolith-desktop.com/docs/howtos/stage-configs/>Stage Config Files</a></li><li><a href=https://regolith-desktop.com/docs/howtos/multiple-batteries/>Support Multiple Batteries</a></li><li><a href=https://regolith-desktop.com/docs/howtos/gnome-flashback-session/>Verify behavior against upstream</a></li></ul></li><li><input type=checkbox id=section-084ba1dbb512652712ad881ff8045610 class=toggle checked>
<label for=section-084ba1dbb512652712ad881ff8045610 class="flex justify-between"><a href=https://regolith-desktop.com/docs/reference/>Reference</a></label><ul><li><a href=https://regolith-desktop.com/docs/reference/keybindings/>Keybindings</a></li><li><a href=https://regolith-desktop.com/docs/reference/configurations/>Config Files</a></li><li><a href=https://regolith-desktop.com/docs/reference/xresources/>Xresources</a></li><li><input type=checkbox id=section-b2dbd6f0eb55391244ec47ab44f365a6 class=toggle>
<label for=section-b2dbd6f0eb55391244ec47ab44f365a6 class="flex justify-between"><a href=https://regolith-desktop.com/docs/reference/Releases/>Releases</a></label><ul><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-3.1-release-notes/>3.1 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-3.0-release-notes/>3.0 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-2.2-release-notes/>2.2 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-2.1-release-notes/>2.1 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-2.0-release-notes/>2.0 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.6.0-release-notes/>1.6 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.5.3-release-notes/>1.5.3 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.5.2-release-notes/>1.5.2 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.5.1-release-notes/>1.5.1 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.5-release-notes/>1.5 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.4.1-release-notes/>1.4.1 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.4-release-notes/>1.4 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.3.1-release-notes/>1.3.1 Release Notes</a></li><li><a href=https://regolith-desktop.com/docs/reference/Releases/regolith-1.3-release-notes/>1.3 Release Notes</a></li></ul></li><li><a href=https://regolith-desktop.com/docs/reference/build-system/ class=active>Build System</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li><li><a href=https://github.com/orgs/regolith-linux/discussions target=_blank rel=noopener>Help & Discussion</a></li><li><a href=https://github.com/regolith-linux target=_blank rel=noopener>Github</a></li><li><a href=https://opencollective.com/regolith/donate target=_blank rel=noopener>Support Regolith<br><br><img src=https://badgen.net/opencollective/backers/regolith></a></li></ul></nav><script>(function(){var menu=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Build System</strong>
<label for=toc-control></label></div></header><article class=markdown><h1 id=overview>Overview
<a class=anchor href=#overview>#</a></h1><p>This page describes how packages are generate from source code, and how those packages combine to actualize the Regolith desktop environment. This document covers Regolith only and does not intend to describe upstream dependencies, general package manager concepts, or other aspects of build systems.</p><h1 id=terms>Terms
<a class=anchor href=#terms>#</a></h1><ul><li><code>Distro</code> - Short for distribution, in the context of this document, may be considered a variation of a Linux-based OS operating system. A product, project, and brand.</li><li><code>Codename</code> - A well defined and announced snapshot of a set of packages that are consumed as a whole. May be considered a software release with a specific name such as <code>36</code> or <code>Jammy</code>.</li><li><code>Architecture</code> - In the context of this document, denotes a CPU and base system hardware. Regolith currently targets the <code>amd64</code> and <code>arm64</code> architectures.</li><li><code>Stage</code> - Represents a snapshot of a set of packages at a modeled level of maturity. In Regolith the following stages from least-stable to most-stable are modeled:<ol><li><code>experimental</code> - For packages and package changes that may be reverted, removed, or change significantly over time. Serious bugs are common and expected here.</li><li><code>unstable</code> - For packages changes that are planned to reach a release but have yet to undergo much testing. Serious bugs may occur from time to time. Regolith core developers may run their testing and development from this stage but users are discouraged from consuming packages from <code>unstable</code>.</li><li><code>testing</code> - For packages undergoing testing by Regolith developers and early adopters. Bugs occur but serious bugs should not often pop up in this stage. Regolith users that wish to get access to fixes and new features earlier may consume from this stage with the understanding that bugs are to be expected (, and reporting them is appreciated!)</li><li><code>release</code> - For packages that have been determined to be suitable for general use. While minor bugs may be present in packages at this stage, the bugs present should not interfere with general use of the environments for users on supported distros and releases.</li></ol></li><li><code>Target</code> ~ Represents a specific sequence of <code>distro</code>, <code>codename</code>, <code>stage</code>, and <code>architecture</code> for which a set of packages exist.</li><li><code>Manifest</code> ~ A file that specifies a set of the properties name, origin, and snapshot for a list of packages. A manifest is a file that represents a snapshot of a <code>target</code> in time.</li><li><code>Package Manager</code> ~ A set of formats and programs that allow for packages to be installed in a distro. The package manager may very by distro.</li><li><code>Package Repository</code> ~ A well defined source of binary packages that may be installed into an OS that supports a given package manager.</li></ul><h1 id=source-repositories>Source Repositories
<a class=anchor href=#source-repositories>#</a></h1><p>All Regolith packages are generated from git-versioned source repositories. These repositories house the source code for a given component. Mostly, each component is general for any given <code>distro</code> and <code>codename</code>. Source repositories are modeled in the Regolith build system via <code>manifest</code> files.</p><h1 id=manifests>Manifests
<a class=anchor href=#manifests>#</a></h1><p>The Regolith build system reads and writes text files known as manifests. The files are initially read as the source of truth for what a given <code>target</code> package repository should contain. If the build system determines if there are updates to the manifest present in the manifest&rsquo;s source repositories, then any updates are built into package updates and published to the target repo along with the updated manifest. In the case that no updates are found, the build simply completes without any changes. As such, a given target&rsquo;s manifest can be used to determine what packages, versions, and source branches/tags are present.</p><h2 id=manifest-schema>Manifest Schema
<a class=anchor href=#manifest-schema>#</a></h2><p>Manifests are simply text files with one package per line, and each element in on a line separated by a space (ASCII 32).</p><pre><code>&lt;PACKAGE NAME&gt; &lt;PACKAGE REPO URL&gt; &lt;PACKAGE REPO BRANCH/TAG&gt; &lt;PACKAGE REPO COMMIT HASH&gt;
</code></pre><h1 id=package-model>Package Model
<a class=anchor href=#package-model>#</a></h1><p>The Regolith build system utilizes sets of JSON files to define what packages are specified for a given <code>target</code>. These JSON files are set in a specific structure to facilitate overriding higher-scoped contexts for lower-scoped contexts. For example, at the top level is the <code>release</code> directory. It specifies all packages for that release. Within a <code>release</code>, directories for specific <code>distro</code>s exist. Package models in these directories may override or nullify packages specified from it&rsquo;s parent. In this way, a top-level general package model can be tweaked for a given <code>stage</code>/<code>distro</code>/<code>codename</code>/<code>architecture</code>. To further illustrate this point here is the structure of the <code>stage</code> directory in the <a href=https://github.com/regolith-linux/voulage><code>voulage</code> repo</a> (which is the name of the Regolith 2.x package builder) (NOTE: some files were removed for brevity):</p><pre><code>stage/
├── package-model.json                &lt;--- Root package model
├── release
│   ├── debian
│   │   └── bullseye
│   │       └── package-model.json
│   ├── package-model.json            &lt;--- Package model for the release stage
│   └── ubuntu
│       └── jammy
│           └── package-model.json
├── testing
│   ├── debian
│   │       └── package-model.json
│   ├── package-model.json
│   └── ubuntu
│       └── jammy
│           └── package-model.json
└── unstable
    ├── debian
    │   ├── bullseye
    │   │   └── package-model.json
    │   └── testing
    │       └── package-model.json    &lt;--- Customizations for Debian Testing in unstable stage
    ├── package-model.json
    └── ubuntu
        └── jammy
            └── package-model.json

</code></pre><h1 id=packages>Packages
<a class=anchor href=#packages>#</a></h1><p>As mentioned above, the build system generates packages for a given target from it&rsquo;s manifest. The build system is designed to be agnostic to any particular package format. As such, package versions are not directly modeled in manifests. The mechanism that determines if a source change results in a version bump is delegated to package-manager specific extensions. After a package has been identified to require building, the build system delegates to the package-specific build system to generate the target packages, such as debian source and binary packages. If the package update builds successfully, another package-manager extension is called to inject the newly built package into the distro-dependant package repository.</p><h1 id=package-build-system>Package Build System
<a class=anchor href=#package-build-system>#</a></h1><p>The Regolith build system consists mainly of bash <a href=https://github.com/regolith-linux/voulage/.github/scripts>shell scripts</a>. These scripts are run from <a href=https://github.com/regolith-linux/voulage/.github/workflows>GitHub workflows</a> but are designed to be runnable directly from the appropriate local environment to facilitate easy testing and troubleshooting. The following is a high level summary of what the package builder does once invoked:</p><ol><li>Set up source state such as the target string, which is generated from <code>&lt;stage>-&lt;distro>-&lt;codename>-&lt;architecture></code></li><li>Download the current manifest from the target repository</li><li>Generate the merged package model starting from the root and working into each segment in the <code>target</code> string</li><li>With the merged model, iterate over each package, generating a manifest entry by resolving the commit hash from the specified ref</li><li>After all manifest entries are generated, compare the generated manifest with the earlier downloaded copy</li><li>If no changes found, exit because no packages have changes on the specified refs</li><li>Otherwise, package changes have been detected. Download the entire target repository</li><li>For each difference found, delegate to distro-specific build package build and repo publish commands</li><li>Publish the updated repository and manifest back to the target repository</li></ol><h1 id=iso-build-system>ISO Build System
<a class=anchor href=#iso-build-system>#</a></h1><p>The ISO builder is based on the open source project <a href=https://github.com/mvallim/live-custom-ubuntu-from-scratch/>live-custom-ubuntu-from-scratch</a>. The ISO builder uses a set of shell scripts to generate an Ubuntu ISO image for both a live environment and an installer. Regolith customizes this project in <a href=https://github.com/regolith-linux/regolith-ubuntu-iso-builder>this repo</a> with some specific packages to <a href=https://github.com/regolith-linux/regolith-ubuntu-iso-builder/blob/main/scripts/regolith-2_1-jammy-config.sh>install and remove</a>. A github workflow is used to generate the ISOs and upload them to GitHub for hosting.</p><h1 id=cookbook>Cookbook
<a class=anchor href=#cookbook>#</a></h1><h2 id=how-to-add-or-update-a-package-to-the-build-system>How to add or update a package to the build system
<a class=anchor href=#how-to-add-or-update-a-package-to-the-build-system>#</a></h2><ol><li>Determine which <code>stage</code>s, <code>distro</code>s, <code>codename</code>s, and <code>architecture</code>s the change applies to (ex: <code>unstable-ubuntu-jammy-amd64</code>)</li><li>Edit the package model in the <code>stage</code> directory in the <a href=https://github.com/regolith-linux/voulage>Voulage</a></li><li>Add or edit the package stanza JSON for that package (<a href=https://github.com/regolith-linux/voulage/commit/cd4a3ebed9c501610810e7d4c79c4811c992c426>example</a>)</li><li>Commit the change</li><li>Execute the <a href=https://github.com/regolith-linux/voulage/actions>build workflow</a></li><li>Once the build completes, check the <code>releases</code> in Voulage to verify that the generated packages were produced and published as expected</li></ol><h2 id=how-to-determine-what-commit-a-package-is-built-with-in-a-given-target-package-repo>How to determine what commit a package is built with in a given target package repo
<a class=anchor href=#how-to-determine-what-commit-a-package-is-built-with-in-a-given-target-package-repo>#</a></h2><ol><li>Download the manifest contained in the target package repository (<code>https://regolith-desktop.org/&lt;STAGE>-&lt;DISTRO>-&lt;CODENAME>-&lt;ARCH>/manifest.txt</code>)</li><li>Find the line containing the package name</li><li>Note the branch and ref in the manifest, this is the repo commit from which the package was built</li></ol><h2 id=how-to-extend-the-build-system-for-a-new-package-format>How to extend the build system for a new package format
<a class=anchor href=#how-to-extend-the-build-system-for-a-new-package-format>#</a></h2><ol><li>For an example read the <a href=https://github.com/regolith-linux/voulage/blob/main/.github/workflows/build-deb-v4.yml>Debian v4 build workflow</a></li><li>Refer to the <a href=https://github.com/regolith-linux/voulage/blob/main/.github/scripts/ext-debian.sh>Debian extension script</a> that the workflow uses</li><li>Create an extension script that maps from the git source of each package to the target distro&rsquo;s packaging format</li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/regolith-linux/regolith-desktop-website/commit/a359a6a294e034f1acc1935e01aa0eb19ce525ba title="Last modified by Ken Gilmer | March 5, 2024" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 5, 2024</span></a></div></div><script>(function(){function select(element){const selection=window.getSelection();const range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range);}
document.querySelectorAll("pre code").forEach(code=>{code.addEventListener("click",function(event){select(code.parentElement);if(navigator.clipboard){navigator.clipboard.writeText(code.parentElement.textContent);}});});})();</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>